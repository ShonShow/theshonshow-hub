import { client } from "../sanity/client";
import { ytToEmbed } from "./(site)/components/utils";
import TeamPanel from "./(site)/components/TeamPanel";

async function getData(){if(!client){const res=await fetch(`${process.env.NEXT_PUBLIC_BASE_URL||""}/content.json`).catch(()=>null);try{return res?await res.json():null}catch{return null}}const siteSettings=await client.fetch(`*[_type=="siteSettings"][0]`);const press=await client.fetch(`*[_type=="pressItem"]{title,url,"cover":cover.asset->url}|order(_createdAt desc)`);const events=await client.fetch(`*[_type=="eventItem"]|order(date asc)`);const galleryDocs=await client.fetch(`*[_type=="galleryImage"]{"image":image.asset->url,alt}|order(_createdAt desc)`);const team=await client.fetch(`*[_type=="teamMember"]|order(_createdAt asc)`);return{siteSettings,press,events,gallery:galleryDocs,team}};

export default async function Home(){const data=await getData();const s=data?.siteSettings||{};const press=data?.press||[];const events=data?.events||[];const gallery=data?.gallery||[];const team=data?.team||[];const heroTitle=s?.heroTitle||"האתר המרכזי של שון — HUB";const heroSubtitle=s?.heroSubtitle||"מכאן מתנתבים לכל מה שקשור אליי...";const heroEmbed=ytToEmbed(s?.heroVideo)||"";const storeUrl=s?.storeUrl||"";return(<main>
<div className="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-b from-neutral-900 to-neutral-950" id="splash"><div className="absolute inset-0 opacity-20 pointer-events-none bg-[url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=1920&auto=format&fit=crop')] bg-cover bg-center" /><div className="relative z-10 mx-4 w-full max-w-xl rounded-3xl glass p-8 shadow-2xl ring-soft text-center"><h1 className="text-3xl md:text-4xl font-bold">ברוכים הבאים ל <span className="text-white">The Shon Show</span></h1><p className="mt-3 text-neutral-300">HUB רשמי — חנות, הופעות ושיתופי פעולה.</p><button className="mt-6 btn btn-brand" onClick={()=>{document.getElementById('splash').style.display='none';}}>להיכנס לאתר <span className="inline-block rotate-180">➜</span></button><button aria-label="סגור מסך פתיחה" onClick={()=>{document.getElementById('splash').style.display='none';}} className="absolute top-4 left-4 p-2 rounded-full bg-white/10 hover:bg-white/20">✕</button></div></div>
<header className="sticky top-0 z-40 bg-neutral-950/70 backdrop-blur border-b border-white/5"><div className="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between"><a href="#top" className="flex items-center gap-3"><img src="/logo.png" alt="The Shon Show" className="w-9 h-9 rounded-full bg-black/50" /><span className="font-semibold">The Shon Show</span></a><nav className="hidden md:flex items-center gap-6">{storeUrl?<a href={storeUrl} target="_blank" className="hover:text-white/90 inline-flex items-center gap-2">חנות 🛍️</a>:<a href="#" aria-disabled="true" title="החנות תיפתח בקרוב" className="hover:text-white/90 inline-flex items-center gap-2">חנות 🛍️</a>}<a href="#brands" className="hover:text-white/90">ללקוחות/מותגים</a><a href="#events" className="hover:text-white/90">לוח הופעות</a><a href="#contact" className="hover:text-white/90">יצירת קשר</a></nav><div className="flex md:hidden"><a href="#contact" className="btn btn-brand px-4 py-2">צור קשר</a></div></div></header>
<section id="top" className="relative"><div className="absolute inset-0 pointer-events-none" style={{background:"radial-gradient(ellipse at top, rgba(217,70,239,0.12), rgba(14,165,233,0.06), transparent)"}} /><div className="mx-auto max-w-7xl px-4 py-14 md:py-24 grid md:grid-cols-2 gap-10 items-center"><div><h2 className="text-4xl md:text-5xl font-extrabold leading-tight">{heroTitle}</h2><p className="mt-4 text-neutral-300 leading-relaxed">{heroSubtitle}</p><div className="mt-6 flex flex-wrap gap-3">{storeUrl?<a href={storeUrl} target="_blank" className="btn btn-brand">לחנות 🛍️</a>:<a href="#" aria-disabled="true" title="החנות תיפתח בקרוב" className="btn btn-outline">לחנות 🛍️</a>}<a href="#brands" className="btn btn-outline">ללקוחות/מותגים 📣</a><a href="#events" className="btn btn-outline">לוח הופעות 📅</a></div></div><div><div className="relative aspect-video rounded-2xl overflow-hidden ring-1 ring-white/10 shadow-2xl">{heroEmbed?<iframe className="absolute inset-0 w-full h-full" src={`${heroEmbed}?rel=0`} title="Featured Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowFullScreen />:<div className="absolute inset-0 grid place-items-center text-neutral-400">הוסף קישור לוידאו ב-Studio</div>}<div className="absolute bottom-2 right-2 bg-neutral-900/70 px-3 py-1 rounded-full text-xs flex items-center gap-1">▶ וידאו אחרון מהערוץ</div></div></div></div></section>
<section className="py-14 md:py-20 border-t border-white/5"><div className="mx-auto max-w-7xl px-4"><h2 className="text-3xl md:text-4xl font-extrabold">צוות / קולאבס</h2><p className="mt-3 text-neutral-300">לחיצה על שם → נפתח פאנל מידע בתוך הדף.</p><div className="mt-6"><TeamPanel members={team} /></div></div></section>
<section id="brands" className="relative py-14 md:py-20 border-t border-white/5"><div className="mx-auto max-w-7xl px-4"><div className="max-w-3xl"><h2 className="text-3xl md:text-4xl font-extrabold">מידע ללקוחות ושותפים</h2><p className="mt-3 text-neutral-300">תקשורת, קייסים ושיתופי פעולה.</p></div><div className="mt-8 grid gap-4 md:grid-cols-3">{press.map((p,i)=>(<a key={i} href={p.url} target="_blank" className="rounded-2xl overflow-hidden border border-white/10 bg-neutral-900/40 hover:bg-neutral-900/60 transition"><div className="aspect-video bg-[url('https://images.unsplash.com/photo-1556157382-97eda2d62296?q=80&w=1200&auto=format&fit=crop')] bg-cover bg-center" /><div className="p-4"><h3 className="font-bold">{p.title}</h3><p className="text-sm text-neutral-300 mt-1">לקריאה ↗</p></div></a>))}</div></div></section>
<section id="events" className="py-14 md:py-20 border-t border-white/5"><div className="mx-auto max-w-7xl px-4"><div className="max-w-3xl"><h2 className="text-3xl md:text-4xl font-extrabold">לוח הופעות ואירועים</h2><p className="mt-3 text-neutral-300">{events.length?"איפה אני מופיע בקרוב — ואם יש מכירת כרטיסים, תמצאו לינק.":"אין כרגע אירועים פתוחים לקהל. עקבו כאן לעדכונים."}</p></div><div className="mt-8 grid gap-4">{events.map((e,idx)=>(<div key={idx} className="rounded-2xl border border-white/10 bg-neutral-900/40 p-4 md:p-5 flex flex-col md:flex-row md:items-center md:justify-between"><div className="flex items-center gap-4"><div className="text-center"><div className="text-2xl font-extrabold">{new Date(e.date).toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit'})}</div><div className="text-xs text-neutral-400">{new Date(e.date).toLocaleDateString('he-IL',{year:'numeric'})}</div></div><div><div className="font-bold">{e.city} — {e.venue}</div><div className="text-sm text-neutral-300">דלתות 19:30 · תחילת מופע 20:30</div></div></div><div className="mt-3 md:mt-0 flex items-center gap-3">{e.tickets&&<a href={e.tickets} className="btn btn-brand px-4 py-2">כרטיסים</a>}<a href="#" className="btn btn-outline px-4 py-2">הוסף ליומן</a></div></div>))}</div></div></section>
<section className="py-14 md:py-20 border-t border-white/5"><div className="mx-auto max-w-7xl px-4"><h2 className="text-3xl md:text-4xl font-extrabold">תמונות והיילייטס</h2><p className="mt-3 text-neutral-300 max-w-3xl">קטע קטן מהאווירה: צילומי הופעות, בקסטייג' ומאחורי הקלעים.</p><div className="mt-6 grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">{gallery.map((g,i)=>(<div key={i} className="aspect-[4/5] rounded-2xl overflow-hidden bg-[url('https://images.unsplash.com/photo-1464375117522-1311d6a5b81f?q=80&w=1200&auto=format&fit=crop')] bg-cover bg-center" />))}</div></div></section>
<section id="contact" className="py-14 md:py-20 border-t border-white/5"><div className="mx-auto max-w-7xl px-4 grid md:grid-cols-2 gap-8 items-center"><div><h2 className="text-3xl md:text-4xl font-extrabold">בואו נדבר</h2><p className="mt-3 text-neutral-300">להזמנת הופעות ואירועים, שיתופי פעולה או שאלות — מוזמנים לפנות.</p><div className="mt-6 flex flex-wrap gap-3"><a href={`tel:${s?.contact?.phoneTel||"+972539451224"}`} className="btn btn-brand">הזמנת הופעות ואירועים ☎ {s?.contact?.phoneDisplay||"053-9451224"}</a><a href={`mailto:${s?.contact?.email||"theshonshow@gmail.com"}`} className="btn btn-outline">✉ {s?.contact?.email||"theshonshow@gmail.com"}</a></div></div><form className="rounded-2xl glass ring-soft p-6"><div className="grid grid-cols-1 md:grid-cols-2 gap-3"><div><label className="text-sm text-neutral-300">שם מלא</label><input className="w-full mt-1 px-3 py-2 rounded-xl bg-neutral-800/50 border border-white/10 outline-none focus:ring-2 focus:ring-white/20" placeholder="שם" /></div><div><label className="text-sm text-neutral-300">אימייל</label><input type="email" className="w-full mt-1 px-3 py-2 rounded-xl bg-neutral-800/50 border border-white/10 outline-none focus:ring-2 focus:ring-white/20" placeholder="you@email.com" /></div><div className="md:col-span-2"><label className="text-sm text-neutral-300">איך אפשר לעזור?</label><textarea className="w-full mt-1 px-3 py-2 min-h-[120px] rounded-xl bg-neutral-800/50 border border-white/10 outline-none focus:ring-2 focus:ring-white/20" placeholder="ספרו בכמה מילים על הבקשה" /></div></div><button type="button" className="mt-4 w-full btn btn-brand">שליחה</button><p className="mt-2 text-xs text-neutral-400">* טופס דמה — נחבר ל-Email/CRM.</p></form></div></section>
<footer className="border-t border-white/5 py-10"><div className="mx-auto max-w-7xl px-4 flex flex-col md:flex-row items-center justify-between gap-4"><div className="text-sm text-neutral-400">© {new Date().getFullYear()} The Shon Show — כל הזכויות שמורות</div><div className="flex items-center gap-4 opacity-90">{s?.social?.youtube&&<a href={s.social.youtube} target="_blank" aria-label="YouTube">YouTube</a>}{s?.social?.instagram&&<a href={s.social.instagram} target="_blank" aria-label="Instagram">Instagram</a>}{s?.social?.tiktok&&<a href={s.social.tiktok} target="_blank" aria-label="TikTok">TikTok</a>}</div></div></footer>
<script dangerouslySetInnerHTML={{__html:`setTimeout(function(){var s=document.getElementById('splash'); if(s) s.style.display='none';}, 2200);`}} />
</main>);}
